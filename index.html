<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#E63946">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SUNNY Stock">
    
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πá‡∏≠‡∏Å - SUNNY</title>

    <!-- Favicon & App Icon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0iI0U2Mzk0NiIgcng9IjgwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9IjkwMCIgZm9udC1zdHlsZT0iaXRhbGljIiBmb250LXNpemU9IjM1MCI+UzwvdGV4dD48L3N2Zz4=">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0iI0U2Mzk0NiIgcng9IjgwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9IjkwMCIgZm9udC1zdHlsZT0iaXRhbGljIiBmb250LXNpemU9IjM1MCI+UzwvdGV4dD48L3N2Zz4=">

    <!-- Web App Manifest (Embedded) -->
    <link rel="manifest" id="my-manifest-placeholder">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script>
        // Inject Manifest Dynamically to handle relative paths correctly
        const manifest = {
            "name": "SUNNY Stock Checker",
            "short_name": "SUNNY Stock",
            "start_url": window.location.href, 
            "display": "standalone",
            "background_color": "#F1FAEE",
            "theme_color": "#E63946",
            "icons": [
                {
                    "src": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0iI0U2Mzk0NiIgcng9IjgwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9IjkwMCIgZm9udC1zdHlsZT0iaXRhbGljIiBmb250LXNpemU9IjM1MCI+UzwvdGV4dD48L3N2Zz4=",
                    "sizes": "512x512",
                    "type": "image/svg+xml"
                }
            ]
        };
        const stringManifest = JSON.stringify(manifest);
        const blobManifest = new Blob([stringManifest], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blobManifest);
        document.querySelector('#my-manifest-placeholder').setAttribute('href', manifestURL);

        // --- PWA SERVICE WORKER REGISTRATION (Single File Trick) ---
        if ('serviceWorker' in navigator) {
            const swContent = `
                self.addEventListener('install', (e) => {
                    e.waitUntil(self.skipWaiting());
                });
                self.addEventListener('activate', (e) => {
                    e.waitUntil(self.clients.claim());
                });
                self.addEventListener('fetch', (e) => {
                    e.respondWith(fetch(e.request));
                });
            `;
            const swBlob = new Blob([swContent], {type: 'text/javascript'});
            const swUrl = URL.createObjectURL(swBlob);
            navigator.serviceWorker.register(swUrl)
                .then(() => console.log('Service Worker Registered'))
                .catch(err => console.log('SW Error:', err));
        }

        // --- SECURITY ---
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.onkeydown = e => {
            if(e.keyCode == 123) return false; 
            if(e.ctrlKey && e.shiftKey && (e.keyCode == 'I'.charCodeAt(0) || e.keyCode == 'C'.charCodeAt(0) || e.keyCode == 'J'.charCodeAt(0))) return false;
            if(e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) return false;
        };
        
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Sarabun', 'Inter', 'sans-serif'],
                        display: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'sunny-red': '#E63946',
                        'sunny-dark': '#1D3557',
                        'sunny-bg': '#F1FAEE',
                    }
                }
            }
        }
    </script>
    <style>
        .loader {
            border-top-color: #E63946;
            -webkit-animation: spin 1s ease-in-out infinite;
            animation: spin 1s ease-in-out infinite;
        }
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .wooden-pattern {
            background-color: #ffffff;
            background-image: repeating-linear-gradient(180deg, rgba(210, 180, 140, 0.05) 0px, rgba(210, 180, 140, 0.05) 15px, rgba(0, 0, 0, 0.02) 16px, transparent 16px, transparent 24px);
        }

        .bento-card {
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .bento-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        
        .fade-in-up {
            animation: fadeInUp 0.4s ease-out forwards;
            opacity: 0;
            transform: translateY(10px);
        }
        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Intro Animation Styles (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô) --- */
        @keyframes letterSlideIn {
            0% { transform: translateX(100px); opacity: 0; }
            60% { transform: translateX(-10px); opacity: 1; }
            100% { transform: translateX(0); opacity: 1; }
        }
        .letter-animate {
            display: inline-block;
            opacity: 0; /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ */
            animation: letterSlideIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        .menu-item.active {
            background-color: #FEF2F2;
            color: #E63946;
            border-right: 4px solid #E63946;
            font-weight: 600;
        }
        
        .noselect {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body class="bg-gray-50 h-[100dvh] font-sans text-slate-800 flex overflow-hidden noselect">

    <!-- Intro Splash Screen (‡∏õ‡∏£‡∏±‡∏ö z-index ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•) -->
    <div id="intro-splash" class="fixed inset-0 bg-white z-[9999] flex flex-col items-center justify-center transition-opacity duration-700 ease-out">
        <div class="flex items-center gap-1 md:gap-2">
            <!-- Animation Letters -->
            <span class="text-7xl md:text-9xl font-black text-sunny-red italic tracking-tighter letter-animate" style="animation-delay: 0.1s">S</span>
            <span class="text-7xl md:text-9xl font-black text-sunny-red italic tracking-tighter letter-animate" style="animation-delay: 0.2s">U</span>
            <span class="text-7xl md:text-9xl font-black text-sunny-red italic tracking-tighter letter-animate" style="animation-delay: 0.3s">N</span>
            <span class="text-7xl md:text-9xl font-black text-sunny-red italic tracking-tighter letter-animate" style="animation-delay: 0.4s">N</span>
            <span class="text-7xl md:text-9xl font-black text-sunny-red italic tracking-tighter letter-animate" style="animation-delay: 0.5s">Y</span>
        </div>
        <p class="mt-6 text-slate-400 text-sm md:text-base font-bold uppercase tracking-[0.5em] opacity-0 animate-[fadeInUp_0.8s_ease-out_0.8s_forwards]">Stock System</p>
    </div>

    <!-- Mobile Menu Button -->
    <button onclick="toggleSidebar()" class="md:hidden fixed top-3 left-3 z-50 bg-white/90 backdrop-blur p-2.5 rounded-xl shadow-lg border border-slate-100 text-slate-600 active:scale-95 transition-transform">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
    </button>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed inset-y-0 left-0 z-40 w-72 bg-white shadow-2xl transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out border-r border-slate-100 flex flex-col h-full">
        <div class="p-6 border-b border-slate-100 flex items-center gap-3 pt-12 md:pt-6">
             <div class="w-10 h-10 bg-sunny-red rounded-lg flex items-center justify-center text-white font-black italic text-xl shadow-red-200 shadow-lg shrink-0 overflow-hidden">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0iI0U2Mzk0NiIgcng9IjgwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9IjkwMCIgZm9udC1zdHlsZT0iaXRhbGljIiBmb250LXNpemU9IjM1MCI+UzwvdGV4dD48L3N2Zz4=" alt="Logo" class="w-full h-full object-cover">
             </div>
             <div>
                 <h1 class="font-black text-xl text-sunny-red italic tracking-tighter">SUNNY</h1>
                 <p class="text-[10px] text-slate-400 uppercase tracking-widest">Stock System</p>
             </div>
             <button onclick="toggleSidebar()" class="md:hidden ml-auto text-slate-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
             </button>
        </div>

        <nav class="flex-1 overflow-y-auto py-4 space-y-1">
            
            <!-- INSTALL BUTTON (New) -->
            <div id="pwa-install-area" class="px-6 mb-6 hidden">
                <button id="pwa-install-btn" class="w-full bg-slate-900 text-white p-3 rounded-xl flex items-center justify-center gap-2 shadow-lg hover:bg-slate-800 transition-all active:scale-95">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    <span class="font-bold text-sm">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ</span>
                </button>
            </div>

            <div class="px-6 mb-3 text-xs font-bold text-slate-400 uppercase tracking-wider">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
            
            <!-- Menus -->
            <a href="#" onclick="switchSystem('WOOD')" id="menu-WOOD" class="menu-item active flex items-center px-6 py-4 text-slate-600 hover:bg-slate-50 transition-colors">
                <div class="w-8 flex justify-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg></div>
                <span class="font-medium">‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ</span>
            </a>
            <a href="#" onclick="switchSystem('ALU')" id="menu-ALU" class="menu-item flex items-center px-6 py-4 text-slate-600 hover:bg-slate-50 transition-colors">
                <div class="w-8 flex justify-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" /></svg></div>
                <div class="flex flex-col"><span class="font-medium">‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</span><span class="text-[10px] text-slate-400">25mm.</span></div>
            </a>
            <a href="#" onclick="switchSystem('PVC')" id="menu-PVC" class="menu-item flex items-center px-6 py-4 text-slate-600 hover:bg-slate-50 transition-colors">
                <div class="w-8 flex justify-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 00-2-2h-2a2 2 0 00-2 2" /></svg></div>
                <div class="flex flex-col"><span class="font-medium">‡∏â‡∏≤‡∏Å PVC</span><span class="text-[10px] text-slate-400">(‡πÉ‡∏ö 8.5/10 cm)</span></div>
            </a>
            <a href="#" onclick="switchSystem('ROLLER')" id="menu-ROLLER" class="menu-item flex items-center px-6 py-4 text-slate-600 hover:bg-slate-50 transition-colors">
                <div class="w-8 flex justify-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg></div>
                <span class="font-medium">‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô</span>
            </a>
            <a href="#" onclick="alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£')" class="menu-item flex items-center px-6 py-4 text-slate-400 hover:bg-slate-50 transition-colors cursor-not-allowed grayscale opacity-60">
                <div class="w-8 flex justify-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg></div>
                <span class="font-medium">‡∏â‡∏≤‡∏Å‡∏¢‡∏π‡πÇ‡∏£</span>
            </a>
        </nav>

        <div class="p-6 border-t border-slate-100">
            <button onclick="toggleHelpModal(true)" class="w-full flex items-center justify-center gap-2 bg-slate-100 text-slate-600 py-3 rounded-xl text-sm font-bold hover:bg-slate-200 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            </button>
        </div>
    </aside>

    <div id="sidebarOverlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden backdrop-blur-sm transition-opacity"></div>

    <main class="flex-1 md:ml-72 h-full overflow-y-auto overflow-x-hidden scrolling-touch relative">
        <div class="p-4 pt-16 md:p-8 pb-40 max-w-6xl mx-auto space-y-6">

            <!-- Header Section -->
            <div id="headerSection" class="bg-white rounded-[2rem] p-6 md:p-8 shadow-sm border border-slate-100 wooden-pattern relative overflow-hidden">
                <div class="absolute top-0 right-0 w-48 h-48 bg-red-50 rounded-full blur-3xl -mr-16 -mt-16 opacity-60 pointer-events-none"></div>
                <div class="relative z-10">
                    <h2 id="systemTitle" class="text-xs md:text-sm font-bold text-slate-400 uppercase tracking-widest mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ</h2>
                    <h1 class="text-3xl md:text-5xl font-black text-slate-800 tracking-tight leading-tight">
                        ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö<span class="text-sunny-red italic block md:inline" id="productTypeLabel">‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ</span>
                    </h1>
                    <div class="mt-3 flex flex-wrap items-center gap-3">
                        <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-green-50 text-green-700 text-xs font-bold border border-green-100">
                            <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                            Online
                        </span>
                        <span class="text-slate-400 text-xs">Updated: <span id="lastUpdateDisplay" class="font-semibold text-slate-600">...</span></span>
                    </div>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="sticky top-2 z-20">
                <div class="bg-white/90 backdrop-blur-xl rounded-2xl p-2 shadow-xl shadow-slate-200/50 border border-white/50 flex items-center gap-2 transition-all">
                    
                    <button onclick="toggleCodeListModal(true)" class="p-2 md:px-3 text-slate-400 hover:text-sunny-red hover:bg-red-50 rounded-xl transition-colors flex items-center gap-1" title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                        </svg>
                        <span class="hidden md:inline text-sm font-semibold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™</span>
                    </button>

                    <div class="h-6 w-px bg-slate-200 mx-1"></div>

                    <input 
                        type="text" 
                        id="productCodeInput"
                        class="flex-grow bg-transparent border-none outline-none text-lg font-medium text-slate-800 placeholder-slate-400 h-12 md:h-14 w-full min-w-0"
                        placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™..."
                        onkeypress="if(event.key === 'Enter') searchProduct()"
                        inputmode="search"
                        autocomplete="off"
                        list="codeSuggestions" 
                    >
                    <datalist id="codeSuggestions"></datalist>

                    <button 
                        id="searchButton"
                        onclick="searchProduct()"
                        class="bg-sunny-red hover:bg-red-700 text-white px-5 md:px-8 py-2.5 md:py-3 rounded-xl font-bold text-base md:text-lg shadow-lg shadow-red-200 transition-all active:scale-95 whitespace-nowrap shrink-0"
                    >
                        ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                    </button>
                </div>
            </div>

            <!-- Result Container -->
            <div id="resultContainer" class="min-h-[300px]">
                <!-- Initial State -->
                <div id="initialMessage" class="flex flex-col items-center justify-center h-64 text-slate-400 bg-white rounded-3xl border-2 border-dashed border-slate-200">
                    <div class="bg-slate-50 p-4 rounded-full mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>
                    <p class="font-medium text-slate-500">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
                    <p class="text-xs text-slate-400 mt-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô</p>
                </div>

                <!-- Loading State -->
                <div id="loadingIndicator" class="hidden flex flex-col items-center justify-center h-64 bg-white rounded-3xl shadow-sm">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"></div>
                    <p class="text-slate-500 font-medium animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                </div>

                <!-- Product Card -->
                <div id="productCard" class="hidden animate-fade-in-up space-y-4">
                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 block">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                            <h2 id="productCodeDisplay" class="text-3xl md:text-4xl font-black text-slate-800 break-words"></h2>
                        </div>
                        <div class="flex-[2] pt-4 md:pt-0 border-t md:border-t-0 md:border-l border-slate-100 md:pl-6">
                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 block">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                            <h3 id="productName" class="text-xl md:text-2xl font-bold text-slate-700 leading-snug"></h3>
                        </div>
                    </div>
                    <div id="stockGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4 pb-4"></div>
                </div>

                <!-- Error Message -->
                <div id="errorMessage" class="hidden h-64 bg-red-50 border border-red-100 rounded-3xl flex flex-col items-center justify-center text-red-600 p-6 text-center">
                    <div class="bg-red-100 p-3 rounded-full mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                    </div>
                    <h3 class="text-lg font-bold mb-1">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                    <p id="errorText" class="text-sm text-red-500"></p>
                </div>
            </div>
        </div>
    </main>

    <!-- Code List Modal -->
    <div id="codeListModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] shadow-2xl max-w-md w-full h-[80vh] flex flex-col relative animate-fade-in-up">
            <div class="p-6 border-b border-slate-100 flex justify-between items-center shrink-0">
                <h3 class="text-xl font-bold text-slate-800">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                <button onclick="toggleCodeListModal(false)" class="bg-slate-50 p-2 rounded-full hover:bg-slate-100 text-slate-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-4 space-y-2" id="browseListContainer">
                <div class="flex justify-center items-center h-full text-slate-400">
                    <span class="loader w-6 h-6 border-2 border-slate-300 border-t-sunny-red rounded-full mr-2"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠...
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] shadow-2xl max-w-md w-full p-6 relative animate-fade-in-up max-h-[90vh] overflow-y-auto">
            <button onclick="toggleHelpModal(false)" class="absolute top-4 right-4 bg-slate-50 p-2 rounded-full hover:bg-slate-100 text-slate-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <div class="flex items-center gap-3 mb-4">
                <div class="p-3 bg-blue-50 rounded-2xl">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-slate-800">‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
            </div>
            
            <div class="space-y-4 text-sm text-slate-600">
                <ul class="space-y-2 list-disc pl-4 marker:text-sunny-red">
                    <li>‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</li>
                    <li>‡πÇ‡∏î‡∏¢‡πÉ‡∏´‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ <strong>-</strong> ‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç<br>
                        <span class="text-slate-400 text-xs">‡πÄ‡∏ä‡πà‡∏ô B35-30 , SA-15 , FW-510 , FW-356</span>
                    </li>
                    <li>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
                </ul>

                <!-- iOS Install Guide (Conditional) -->
                <div id="ios-install-guide" class="hidden bg-slate-100 p-4 rounded-xl border border-slate-200 mt-4">
                    <p class="font-bold text-slate-800 mb-2">üì≤ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ö‡∏ô iPhone/iPad</p>
                    <ol class="list-decimal pl-4 space-y-1 text-xs">
                        <li>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>‡πÅ‡∏ä‡∏£‡πå</strong> <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDA3QUZGIiBzdHJva2Utd2lkdGg9IjIiPjxwYXRoIGQ9Ik00IDEydjhoMTZ2LThNMTIgNHYxMk0xMiA0bDUtNW0tNSA1bC01LTUiLz48L3N2Zz4=" class="w-4 h-4 inline align-middle"> ‡∏ó‡∏µ‡πà‡πÅ‡∏ñ‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (Safari)</li>
                        <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π <strong>"‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÇ‡∏Æ‡∏°" (Add to Home Screen)</strong></li>
                        <li>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>‡πÄ‡∏û‡∏¥‡πà‡∏° (Add)</strong> ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô</li>
                    </ol>
                </div>

                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 text-xs md:text-sm">
                    <p class="mb-2">
                        <span class="font-bold text-blue-600">‚Ä¢</span> ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 4ft (1.22 ‡∏°.), 4.5ft (1.37 ‡∏°.), 5ft (1.52 ‡∏°.) ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÉ‡∏ö‡∏°‡∏π‡πà‡∏•‡∏µ‡πà
                    </p>
                    <p class="font-medium text-blue-800">
                        ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ó‡∏µ‡πà 8FT ‡∏•‡∏á‡∏°‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ
                    </p>
                    <p class="mt-2 text-slate-500 italic">
                        "‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏ô‡∏≤‡∏î‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á ‡∏Ñ‡∏∑‡∏≠ ‡∏Å‡∏ß‡πâ‡∏≤‡∏á 168x200 ‡πÅ‡∏ï‡πà‡∏Ç‡∏ô‡∏≤‡∏î 5.5FT ‡∏´‡∏°‡∏î ‡πÅ‡∏ï‡πà‡∏Ç‡∏ô‡∏≤‡∏î 8FT ‡∏°‡∏µ <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡πá‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏¥‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°) ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ô‡∏≥‡πÉ‡∏ö 8FT ‡∏°‡∏≤‡∏ï‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏≠‡∏á</strong>"
                    </p>
                </div>
                
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 mt-4">
                    <p class="text-sm font-bold text-slate-700 mb-3 border-b border-slate-200 pb-2">‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</p>
                    <div class="space-y-3">
                        <div class="flex items-center gap-3">
                            <div class="w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center shrink-0"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div>
                            <span class="font-medium text-slate-700">‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-6 h-6 bg-red-100 text-red-400 rounded-full flex items-center justify-center shrink-0"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"></path></svg></div>
                            <span class="font-medium text-slate-700">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î (0)</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center shrink-0"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"></path></svg></div>
                            <div class="bg-red-50 text-red-600 rounded-lg px-2 py-1 text-xs font-bold border border-red-100">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î (‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 20 ‡∏ä‡∏¥‡πâ‡∏ô)</div>
                        </div>
                    </div>
                </div>
            </div>
            <button onclick="toggleHelpModal(false)" class="mt-6 w-full bg-slate-900 text-white py-3 rounded-xl font-bold hover:bg-slate-800 transition-colors">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>

    <script>
        // DATA URLs
        const WOOD_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQz2OtjzRBmeUmLOTSgJ-Bt2woZPiR9QyzvIWcBXacheG3IplefFZE66yWYE43qVRQo2DAOPu9UClh5/pub?gid=1132498145&single=true&output=csv";
        const PVC_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQz2OtjzRBmeUmLOTSgJ-Bt2woZPiR9QyzvIWcBXacheG3IplefFZE66yWYE43qVRQo2DAOPu9UClh5/pub?gid=1230787558&single=true&output=csv";
        const ROLLER_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQz2OtjzRBmeUmLOTSgJ-Bt2woZPiR9QyzvIWcBXacheG3IplefFZE66yWYE43qVRQo2DAOPu9UClh5/pub?gid=1019928538&single=true&output=csv";
        const ALU_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQz2OtjzRBmeUmLOTSgJ-Bt2woZPiR9QyzvIWcBXacheG3IplefFZE66yWYE43qVRQo2DAOPu9UClh5/pub?gid=1880232984&single=true&output=csv";

        let currentSystem = 'WOOD'; 
        let cache = { WOOD: null, PVC: null, ROLLER: null, ALU: null };
        let deferredPrompt;

        // PWA Install Logic
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const installArea = document.getElementById('pwa-install-area');
            if(installArea) installArea.classList.remove('hidden');
        });

        document.getElementById('pwa-install-btn')?.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    document.getElementById('pwa-install-area').classList.add('hidden');
                }
                deferredPrompt = null;
            }
        });

        // Detect iOS
        const isIos = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        if (isIos) {
            document.getElementById('ios-install-guide').classList.remove('hidden');
        }

        // ... (Existing Functions: toggleSidebar, toggleHelpModal, toggleCodeListModal, switchSystem, updateProductList, isValidCode) ...
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
                document.body.style.overflow = '';
            }
        }

        function toggleHelpModal(show) {
            document.getElementById('helpModal').classList.toggle('hidden', !show);
        }

        function toggleCodeListModal(show) {
            document.getElementById('codeListModal').classList.toggle('hidden', !show);
        }

        function switchSystem(system) {
            currentSystem = system;
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`menu-${system}`).classList.add('active');
            
            let title, label, placeholder;
            if (system === 'WOOD') { title = '‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ'; label = '‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ'; placeholder = '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ (‡πÄ‡∏ä‡πà‡∏ô B35-34)...'; }
            else if (system === 'ALU') { title = '‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°'; label = '‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°'; placeholder = '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ (‡πÄ‡∏ä‡πà‡∏ô 001)...'; }
            else if (system === 'PVC') { title = '‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏â‡∏≤‡∏Å PVC'; label = '‡∏â‡∏≤‡∏Å PVC'; placeholder = '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ (‡πÄ‡∏ä‡πà‡∏ô 926)...'; }
            else if (system === 'ROLLER') { title = '‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô'; label = '‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô'; placeholder = '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ (‡πÄ‡∏ä‡πà‡∏ô SZH...)...'; }
            
            document.getElementById('systemTitle').innerText = title;
            document.getElementById('productTypeLabel').innerText = label;
            document.getElementById('productCodeInput').placeholder = placeholder;
            document.getElementById('productCodeInput').value = '';
            
            document.getElementById('productCard').classList.add('hidden');
            document.getElementById('errorMessage').classList.add('hidden');
            document.getElementById('initialMessage').classList.remove('hidden');
            
            if (window.innerWidth < 768) toggleSidebar();
            updateProductList();
        }

        async function updateProductList() {
            const browseContainer = document.getElementById('browseListContainer');
            browseContainer.innerHTML = `<div class="flex justify-center items-center h-full text-slate-400"><span class="loader w-6 h-6 border-2 border-slate-300 border-t-sunny-red rounded-full mr-2"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠...</div>`;
            try {
                const data = await fetchData();
                const datalist = document.getElementById('codeSuggestions');
                datalist.innerHTML = '';
                browseContainer.innerHTML = ''; 
                const codes = Object.keys(data).sort();
                if(codes.length === 0) {
                    browseContainer.innerHTML = `<div class="text-center text-slate-400 mt-10">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>`;
                    return;
                }
                codes.forEach(code => {
                    const item = data[code];
                    const option = document.createElement('option');
                    option.value = code;
                    datalist.appendChild(option);
                    const listBtn = document.createElement('button');
                    listBtn.className = "w-full text-left bg-slate-50 hover:bg-red-50 p-4 rounded-xl border border-slate-100 hover:border-red-100 transition-all flex justify-between items-center group";
                    listBtn.onclick = () => {
                        document.getElementById('productCodeInput').value = code;
                        toggleCodeListModal(false);
                        searchProduct();
                    };
                    listBtn.innerHTML = `<div><span class="block font-bold text-lg text-slate-700 group-hover:text-sunny-red">${code}</span></div><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-300 group-hover:text-sunny-red" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>`;
                    browseContainer.appendChild(listBtn);
                });
            } catch (error) {
                console.error("Error loading list:", error);
                browseContainer.innerHTML = `<div class="text-center text-red-400 mt-10">‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>`;
            }
        }

        function isValidCode(code) {
            if (!code) return false;
            if (code.includes(',') || code.includes('"')) return false;
            const blacklist = ['SLAT', 'PCS', 'BOX', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', 'NAME', 'CODE', 'PRICE', '35MM', '50MM', 'F-WOOD', '25MM', '‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', '‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠', '‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á'];
            const upper = code.toUpperCase();
            if (blacklist.some(w => upper.includes(w))) return false;
            if (code.length > 20) return false;
            return true;
        }

        // ... (CSV Parsers & Fetch Logic - Same as before) ...
        const STOCK_COLUMNS_WOOD = { '4ft': {col:4, meter:'1.22 ‡∏°.'}, '4.5ft': {col:6, meter:'1.37 ‡∏°.'}, '5ft': {col:8, meter:'1.52 ‡∏°.'}, '5.5ft': {col:10, meter:'1.68 ‡∏°.'}, '6ft': {col:12, meter:'1.83 ‡∏°.'}, '6.5ft': {col:14, meter:'1.98 ‡∏°.'}, '7ft': {col:16, meter:'2.13 ‡∏°.'}, '8ft': {col:18, meter:'2.44 ‡∏°.'} };

        function parseWoodCSV(text) { /* ... same code ... */ 
            const lines = text.trim().split('\n'); const data = {}; let lastCode = null;
            for (let i = 2; i < lines.length; i++) {
                const row = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                const cleanRow = row.map(cell => cell ? cell.trim().replace(/^"|"$/g, '') : '');
                let code = cleanRow[0];
                if (!code && lastCode) { const hasData = Object.values(STOCK_COLUMNS_WOOD).some(o => cleanRow[o.col] && cleanRow[o.col] !== '0'); if (cleanRow[1] || hasData) code = lastCode; }
                if (code) { code = code.toUpperCase(); if (!isValidCode(code)) continue; lastCode = code; if (!data[code]) { data[code] = { name: cleanRow[1] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠', stocks: {} }; Object.keys(STOCK_COLUMNS_WOOD).forEach(k => data[code].stocks[k] = 0); } for (const [k, o] of Object.entries(STOCK_COLUMNS_WOOD)) { if (cleanRow.length > o.col) { const val = parseInt(cleanRow[o.col].replace(/,/g, ''), 10) || 0; data[code].stocks[k] += val; } } }
            } return data;
        }
        function parseAluCSV(text) { /* ... same code ... */ 
            const lines = text.trim().split('\n'); const data = {};
            for (let i = 1; i < lines.length; i++) {
                const row = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                const cleanRow = row.map(cell => cell ? cell.trim().replace(/^"|"$/g, '') : '');
                let code = cleanRow[0];
                if (code) { code = code.toUpperCase(); if (!isValidCode(code)) continue; const val = parseInt(cleanRow[2].replace(/,/g, ''), 10) || 0; if (!data[code]) { data[code] = { name: cleanRow[1] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠', stocks: { '‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠': val } }; } else { data[code].stocks['‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠'] += val; } }
            } return data;
        }
        function parsePvcCSV(text) { /* ... same code ... */ 
            const lines = text.trim().split('\n'); const data = {}; const headerRow = lines[1].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c => c.trim().replace(/^"|"$/g, '')); const heightMap = []; 
            for(let i = 2; i < headerRow.length; i++) { if(headerRow[i] && !isNaN(parseInt(headerRow[i]))) { heightMap.push({ index: i, label: headerRow[i] }); } }
            for (let i = 2; i < lines.length; i++) {
                const row = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); const cleanRow = row.map(cell => cell ? cell.trim().replace(/^"|"$/g, '') : ''); let code = cleanRow[0];
                if (code) { code = code.toUpperCase(); if (!isValidCode(code)) continue; if (!data[code]) data[code] = { name: cleanRow[1] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠', stocks: {} }; heightMap.forEach(h => { if(cleanRow.length > h.index) { const val = parseInt(cleanRow[h.index].replace(/,/g, ''), 10) || 0; data[code].stocks[h.label] = (data[code].stocks[h.label] || 0) + val; } }); }
            } return data;
        }
        function parseRollerCSV(text) { /* ... same code ... */ 
            const lines = text.trim().split('\n'); const data = {};
            for (let i = 3; i < lines.length; i++) {
                const row = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); const cleanRow = row.map(cell => cell ? cell.trim().replace(/^"|"$/g, '') : ''); let code = cleanRow[0];
                if (code) { code = code.toUpperCase(); if (!isValidCode(code)) continue; const val = parseInt(cleanRow[2].replace(/,/g, ''), 10) || 0; if (!data[code]) { data[code] = { name: cleanRow[1] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠', stocks: { '‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠': val } }; } else { data[code].stocks['‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠'] += val; } }
            } return data;
        }

        async function fetchData() {
            if (cache[currentSystem]) return cache[currentSystem];
            let url;
            if (currentSystem === 'WOOD') url = WOOD_CSV_URL; else if (currentSystem === 'ALU') url = ALU_CSV_URL; else if (currentSystem === 'PVC') url = PVC_CSV_URL; else if (currentSystem === 'ROLLER') url = ROLLER_CSV_URL;
            try {
                const response = await fetch(url, { cache: "no-store" }); if (!response.ok) throw new Error('Network Error'); const text = await response.text(); let parsedData;
                if (currentSystem === 'WOOD') parsedData = parseWoodCSV(text); else if (currentSystem === 'ALU') parsedData = parseAluCSV(text); else if (currentSystem === 'PVC') parsedData = parsePvcCSV(text); else if (currentSystem === 'ROLLER') parsedData = parseRollerCSV(text);
                cache[currentSystem] = parsedData; const now = new Date(); document.getElementById('lastUpdateDisplay').innerText = now.toLocaleDateString('th-TH', { hour: '2-digit', minute: '2-digit' }) + ' ‡∏ô.'; return parsedData;
            } catch (e) { console.error(e); throw e; }
        }

        async function searchProduct() {
            const input = document.getElementById('productCodeInput'); const code = input.value.trim().toUpperCase(); if (!code) return;
            const els = ['loadingIndicator', 'productCard', 'errorMessage', 'initialMessage']; els.forEach(id => document.getElementById(id).classList.add('hidden')); document.getElementById('loadingIndicator').classList.remove('hidden'); document.getElementById('searchButton').disabled = true; document.getElementById('searchButton').innerHTML = '<span class="loader block w-5 h-5 border-2 border-white/50 border-t-white rounded-full"></span>';
            try {
                const data = await fetchData(); const result = data[code];
                document.getElementById('loadingIndicator').classList.add('hidden'); document.getElementById('searchButton').disabled = false; document.getElementById('searchButton').innerText = '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤';
                if (result) {
                    document.getElementById('productCodeDisplay').innerText = code; document.getElementById('productName').innerText = result.name;
                    const grid = document.getElementById('stockGrid'); grid.innerHTML = '';
                    const isSingleCard = currentSystem === 'ROLLER' || currentSystem === 'ALU';
                    grid.className = isSingleCard ? 'grid grid-cols-1 gap-4 pb-4 max-w-sm mx-auto' : 'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4 pb-4';
                    
                    const createCard = (label, subLabel, qty) => {
                        const isZero = qty === 0; const isLow = qty > 0 && qty < 20;
                        let bg = isZero ? 'bg-slate-50 opacity-60' : 'bg-white'; let border = isLow ? 'border-red-200 ring-1 ring-red-100' : 'border-slate-100'; let textColor = isLow ? 'text-red-600' : (isZero ? 'text-slate-400' : 'text-slate-800'); let iconColor = isLow ? 'bg-red-500 text-white' : (isZero ? 'bg-red-100 text-red-400' : 'bg-green-500 text-white'); let iconPath = isZero ? 'M6 18L18 6M6 6l12 12' : 'M5 13l4 4L19 7';
                        return `<div class="bento-card relative rounded-2xl p-4 border flex flex-col justify-between ${isSingleCard ? 'h-40 items-center justify-center text-center' : 'h-28'} ${bg} ${border} shadow-sm group"><div class="${isSingleCard ? 'w-full flex justify-between items-center mb-2' : 'flex justify-between items-start'}"><div><span class="font-bold text-base md:text-lg text-slate-700">${label}</span>${subLabel ? `<span class="block text-[10px] text-slate-400 bg-slate-100 px-1.5 rounded-md w-fit mt-0.5 ${isSingleCard ? 'mx-auto' : ''}">${subLabel}</span>` : ''}</div><div class="rounded-full p-1 ${iconColor} shadow-sm"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="${iconPath}"></path></svg></div></div><div class="${isSingleCard ? 'text-center mt-2' : 'text-right'}"><span class="block ${isSingleCard ? 'text-5xl' : 'text-3xl'} font-black ${textColor} tracking-tight leading-none">${qty.toLocaleString()}</span>${isSingleCard ? '<span class="text-sm text-slate-400 mt-1 block">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ä‡∏¥‡πâ‡∏ô/‡∏°‡πâ‡∏ß‡∏ô)</span>' : ''}</div></div>`;
                    };

                    if (currentSystem === 'WOOD') { Object.keys(STOCK_COLUMNS_WOOD).forEach(k => { grid.innerHTML += createCard(k, STOCK_COLUMNS_WOOD[k].meter, result.stocks[k]); }); }
                    else if (currentSystem === 'PVC') { const sortedKeys = Object.keys(result.stocks).sort((a,b) => parseInt(a) - parseInt(b)); sortedKeys.forEach(k => { grid.innerHTML += createCard(`‡∏™‡∏π‡∏á ${k}`, '‡∏ã‡∏°.', result.stocks[k]); }); }
                    else if (currentSystem === 'ROLLER' || currentSystem === 'ALU') { grid.innerHTML += createCard('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠', '', result.stocks['‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠']); }
                    document.getElementById('productCard').classList.remove('hidden');
                } else {
                    document.getElementById('errorMessage').classList.remove('hidden');
                    let systemName = currentSystem === 'PVC' ? '‡∏â‡∏≤‡∏Å PVC' : (currentSystem === 'ROLLER' ? '‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô' : (currentSystem === 'ALU' ? '‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°' : '‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ'));
                    document.getElementById('errorText').innerText = `‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™: ${code} ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ${systemName}`;
                }
            } catch (error) {
                console.error(error); document.getElementById('loadingIndicator').classList.add('hidden'); document.getElementById('searchButton').disabled = false; document.getElementById('searchButton').innerText = '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤'; document.getElementById('errorMessage').classList.remove('hidden'); document.getElementById('errorText').innerText = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            switchSystem('WOOD');
            setTimeout(() => { const splash = document.getElementById('intro-splash'); if(splash) { splash.classList.add('opacity-0', 'pointer-events-none'); setTimeout(() => splash.remove(), 700); } }, 2000);
        });
    </script>
</body>
</html>
